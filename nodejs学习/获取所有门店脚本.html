<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>绑定授权码</title>
</head>
<body>
  <div class="wrapper">
    <h3>获取门店地址</h3>
</div>
    
 </div>
 <script>
  // let provinceArr = [
  //     '上海',
  //     '云南',
  //     '北京',
  //     '吉林',
  //     '四川',
  //     '天津',
  //     '安徽',
  //     '山东',
  //     '山西',
  //     '广东',
  //     '新疆',
  //     '江苏',
  //     '江西',
  //     '河北',
  //     '河南',
  //     '浙江',
  //     '深圳',
  //     '湖北',
  //     '湖南',
  //     '甘肃',
  //     '福建',
  //     '贵州',
  //     '辽宁',
  //     '重庆',
  //     '陕西',
  //     '青海',
  //     '内蒙古']
  //   let cityArr = [
  //       "昆明",
  //       ,"北京"
  //       ,"宜宾", "德阳", "成都"
  //       ,"上海"
  //       ,"长春"
  //       ,"天津"
  //       ,"合肥"
  //       ,"太原", "运城", "长治"
  //       ,"东营", "德州", "济南", "青岛"
  //       ,"佛山", "广州", "深圳"
  //       ,"乌鲁木齐"
  //       ,"南京", "南通", "徐州", "无锡", "苏州"
  //       ,"唐山", "石家庄", "秦皇岛", "邢台", "邯郸"
  //       ,"南昌"
  //       ,"台州", "宁波", "杭州", "温州", "苍南", "诸暨"
  //       ,"郑州"
  //       ,"武汉"
  //       ,"深圳"
  //       ,"长沙"
  //       ,"兰州"
  //       ,"福州"
  //       ,"重庆"
  //       ,"贵阳"
  //       ,"大连", "沈阳"
  //       ,"西安"
  //       ,"西宁"
  //       ,"赤峰"]
  //     // let cod_ids = [425,697,452,488,858,887,913,928,922,31,32,180,561,568,883,898,906,910,916,937,948,951,190,489,893,896,927,949,925,936,942,395,877,878,895,900,909,502,723,503,885,941,911,894,880,905,696,854,908,484,933,429,487,492,196,396,466,924,944,501,914,946,543,950,389,882,892,377,722,886,919,560,853,918,947,550,881,929,923,930,931,213,427,890,926,934,940,847,932,694,917,935,193,421,426,693,876,889,921,196,396,466,924,451,490,727,391,189,477,485,698,884,943,544,476,481,726,888,945,939]
  //     let cod_ids = [425, 697]
  //     function promiseRequest(url, data) {
  //       return new Promise((resolve, reject) => {
  //         var xhr = new XMLHttpRequest()
  //         xhr.onreadystatechange = () => {
  //           if (xhr.readyState === 4) {
  //             if (xhr.status === 200) {
  //               resolve(xhr.responseText)
  //             } else {
  //               reject(xhr.responseText)
  //             }
  //           }
  //         }
  //         xhr.open('POST', url, true);
  //         xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded; charset=UTF-8');
  //         xhr.setRequestHeader('X-CSRF-TOKEN', 'pW5voRgK33u5uILYWwMFbtJBmAomQ45na1GVJmhg');
  //         xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest'); 
  //         xhr.send(data);
  //         }).catch(err => {
  //           console.log(err)
  //         })
  //       }
  //       let shopList = []
  //       cityArr.forEach(item=>{
  //         shopList.push(get_code(item))
  //       })
  //       Promise.all(shopList).then(values => { 
  //         console.log('获取到的数据集合', values)
  //         let result = []
  //         values.forEach(val=>{
  //           val.forEach(subVal=>{
  //             if(subVal.name) {
  //               result.push(subVal)
  //             }
  //           })
  //         })
  //         console.log(1111, result)
  //         exportCSV(result)
  //       })

        result = ""
        for (item of document.querySelectorAll("li")) {
          result +=(item.querySelectorAll("p.title > span.store_name")[0] || {"innerText":""}).innerText + ","
          result += (item.querySelectorAll("p.title > span.type")[0] || {"innerText":""}).innerText + ","
          result += (item.querySelectorAll("p.title > span.tag")[0] || {"innerText":""}).innerText + ","
          result += (item.querySelectorAll("p:nth-child(2) > span.store_address")[0] || {"innerText":""}).innerText + ","
          result += (item.querySelectorAll("p:nth-child(3)")[0] || {"innerText":""}).innerText + "," + "\n"
        }
        console.log(result)

        // function exportCSV(jsonData){
        //   //列标题，逗号隔开，每一个逗号就是隔开一个单元格
        //   let str = `经度,纬度,地址,店铺名称\n`;
        //   //增加\t为了不让表格显示科学计数法或者其他格式
        //   for(let i = 0 ; i < jsonData.length ; i++ ){
        //   for(let item in jsonData[i]){
        //   str+=`${jsonData[i][item] + '\t'},`;
        //   }
        //   str+='\n';
        //   }
        //   //encodeURIComponent解决中文乱码
        //   let uri = 'data:text/csv;charset=utf-8,\ufeff' + encodeURIComponent(str);
        //   //通过创建a标签实现
        //   var link = document.createElement("a");
        //   link.href = uri;
        //   //对下载的文件命名
        //   link.download = "极米门店表.csv";
        //   document.body.appendChild(link);
        //   link.click();
        //   document.body.removeChild(link);
        // }
        // function get_code(data){
        //   return new Promise((resolve, reject)=>{
        //     promiseRequest('/cooperation', 'data=location&city='+data+'&type=0').then((res)=> {
        //     let shop = shopList.concat(JSON.parse(res).data)
        //     resolve(shop)
        //     })
        //   })
        // }      
        
        


      // 省份获取城市
      // let cityList = []
      // provinceArr.forEach((ele, index)=> {
      //   getcity(ele)
      // })
      // function getcity(province){
      //   promiseRequest('/cooperation', "data=city&province="+province).then((res)=> {
      //     let sP = JSON.parse(res)
      //     sP.data.forEach(item => {
      //       item = eval("'" + sP + "'")
      //     });
      //     cityList = cityList.concat(sP.data)
      //     console.log(999, sP.data)
      //     return sP.data      
      //   })
      // }    
      // console.log(cityList)


      // 通过id获取列表
      // let cod_ids = [425,697,452,488,858,887,913,928,922,31,32,180,561,568,883,898,906,910,916,937,948,951,190,489,893,896,927,949,925,936,942,395,877,878,895,900,909,502,723,503,885,941,911,894,880,905,696,854,908,484,933,429,487,492,196,396,466,924,944,501,914,946,543,950,389,882,892,377,722,886,919,560,853,918,947,550,881,929,923,930,931,213,427,890,926,934,940,847,932,694,917,935,193,421,426,693,876,889,921,196,396,466,924,451,490,727,391,189,477,485,698,884,943,544,476,481,726,888,945,939]
      function promiseRequest(url, data) {
        return new Promise((resolve, reject) => {
          var xhr = new XMLHttpRequest()
          xhr.onreadystatechange = () => {
            if (xhr.readyState === 4) {
              if (xhr.status === 200) {
                resolve(xhr.responseText)
              } else {
                reject(xhr.responseText)
              }
            }
          }
          xhr.open('POST', url, true);
          xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded; charset=UTF-8');
          xhr.setRequestHeader('X-CSRF-TOKEN', 'pW5voRgK33u5uILYWwMFbtJBmAomQ45na1GVJmhg');
          xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest'); 
          xhr.send(data);
          }).catch(err => {
            console.log(err)
          })
        }
        // var hhh = [
        //   'arraySort[0][]=null',
        //   'arraySort[0][]=697',
        //   'arraySort[1][]=null',
        //   'arraySort[1][]=697'
        // ]
        let idList = []
        let cod_ids = [425,697,452,488,858,887,913,928,922,31,32,180,561,568,883,898,906,910,916,937,948,951,190,489,893,896,927,949,925,936,942,395,877,878,895,900,909,502,723,503,885,941,911,894,880,905,696,854,908,484,933,429,487,492,196,396,466,924,944,501,914,946,543,950,389,882,892,377,722,886,919,560,853,918,947,550,881,929,923,930,931,213,427,890,926,934,940,847,932,694,917,935,193,421,426,693,876,889,921,196,396,466,924,451,490,727,391,189,477,485,698,884,943,544,476,481,726,888,945,939]
        cod_ids.forEach((item, index)=>{
          console.log(11111, item, index)
          idList.push('arraySort['+index+'][]=null')
          idList.push('arraySort['+index+'][]='+item)
        })
        console.log(idList)
        get_code(idList)
        function get_code(data){
          return new Promise((resolve, reject)=>{   
            promiseRequest('/api/cooperationList', data.join('&')).then((res)=> {
              console.log('结果', res)
            
            })
          })
        }   

        // let data = document.querySelectorAll('li');data.forEach(item=>{console.log(item.innerText.replace(/[\r\n]/g,""))})
      


 </script>
</body>
</html>
